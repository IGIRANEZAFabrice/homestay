<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virunga Homestay Admin - Dashboard</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/modals.css">
    <link rel="stylesheet" href="assets/css/tooltips.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.css">
</head>
<body class="dashboard-page">
    <!-- Connectivity Indicator -->
    <div id="connectivityStatus" class="connectivity-indicator online">
        <i class="fas fa-wifi"></i>
        <span class="status-text">Online</span>
    </div>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-mountain"></i>
                    <span>Virunga Admin</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <div class="sidebar-menu">
                <ul class="menu-list">
                    <li class="menu-item active">
                        <a href="dashboard.html" class="menu-link">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="pages/activities/index.html" class="menu-link">
                            <i class="fas fa-hiking"></i>
                            <span>Activities</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="pages/blogs/index.html" class="menu-link">
                            <i class="fas fa-blog"></i>
                            <span>Blog Posts</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="pages/cars/index.html" class="menu-link">
                            <i class="fas fa-car"></i>
                            <span>Car Rental</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="pages/events/index.html" class="menu-link">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Events</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="pages/rooms/index.html" class="menu-link">
                            <i class="fas fa-bed"></i>
                            <span>Rooms</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="pages/services/index.html" class="menu-link">
                            <i class="fas fa-concierge-bell"></i>
                            <span>Services</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="pages/reviews/index.html" class="menu-link">
                            <i class="fas fa-star"></i>
                            <span>Reviews</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="pages/hero-images/index.html" class="menu-link">
                            <i class="fas fa-images"></i>
                            <span>Hero Images</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="pages/homepage/about.html" class="menu-link">
                            <i class="fas fa-info-circle"></i>
                            <span>Homepage About</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="pages/messages/index.html" class="menu-link">
                            <i class="fas fa-envelope"></i>
                            <span>Messages</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-footer">
                <button class="btn btn-secondary btn-full" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Dashboard</h1>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span>Admin User</span>
                    </div>
                </div>
            </header>

            <!-- Dashboard Content -->
            <div class="dashboard-content">
                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-hiking"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalActivities">0</h3>
                            <p>Total Activities</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-blog"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalBlogs">0</h3>
                            <p>Blog Posts</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-car"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalCars">0</h3>
                            <p>Rental Cars</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalReviews">0</h3>
                            <p>Customer Reviews</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h2>Quick Actions</h2>
                    <div class="action-buttons">
                        <a href="pages/activities/create.html" class="action-btn">
                            <i class="fas fa-plus"></i>
                            <span>Add Activity</span>
                        </a>
                        <a href="pages/blogs/create.html" class="action-btn">
                            <i class="fas fa-plus"></i>
                            <span>Create Blog Post</span>
                        </a>
                        <a href="pages/cars/create.html" class="action-btn">
                            <i class="fas fa-plus"></i>
                            <span>Add Car</span>
                        </a>
                        <a href="pages/events/create.html" class="action-btn">
                            <i class="fas fa-plus"></i>
                            <span>Create Event</span>
                        </a>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="recent-activities">
                    <h2>Recent Activities</h2>
                    <div class="activity-list" id="recentActivitiesList">
                        <!-- Activities will be loaded here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading...</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/connectivity.js"></script>
    <script src="assets/js/tooltips.js"></script>
    <script src="assets/js/modals.js"></script>
    <script src="assets/js/dashboard.js"></script>
    <script>
        // Session-based authentication check for dashboard
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Check if user is authenticated via session
                const response = await fetch('backend/api/auth/session_check.php');
                const data = await response.json();

                if (!data.success || !data.authenticated) {
                    // User is not authenticated, redirect to login
                    window.location.href = 'pages/login.php';
                    return;
                }

                // User is authenticated, update UI with user info
                const userInfo = document.querySelector('.user-info span');
                if (userInfo && data.user) {
                    userInfo.textContent = data.user.full_name || data.user.username;
                }

                console.log('User authenticated:', data.user);

            } catch (error) {
                console.error('Authentication check failed:', error);
                // Redirect to login on error
                window.location.href = 'pages/login.php';
            }
        });

        // Session-based logout function
        async function logout() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    const response = await fetch('backend/api/auth/session_logout.php', {
                        method: 'POST'
                    });

                    const data = await response.json();

                    if (data.success) {
                        // Redirect to login page
                        window.location.href = 'pages/login.php';
                    } else {
                        alert('Logout failed: ' + data.message);
                    }
                } catch (error) {
                    console.error('Logout error:', error);
                    // Force redirect to login even on error
                    window.location.href = 'pages/login.php';
                }
            }
        }
    </script>
</body>
</html>
